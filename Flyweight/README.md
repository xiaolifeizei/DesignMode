## 享元模式（Flyweight）

享元模式

### 一、说明

享元模式（Flyweight）又称为轻量级模式，是一种对象结构型模式。很多情况下需要在系统中增加类和对象的个数。当对象数量太多时，将导致运行代价过高，带来性能下降等问题。享元模式正是为解决这一类问题而诞生的。

享元模式是对象池的一种实现。类似于线程池，线程池可以避免不停的创建和销毁多个对象，消耗性能。享元模式也是为了减少内存的使用，避免出现大量重复的创建销毁对象的场景。

享元模式 把一个对象的状态分成内部状态和外部状态，内部状态即是不变的，外部状态是变化的；然后通过共享不变的部分，达到减少对象数量并节约内存的目的。

- 享元模式的本质：缓存共享对象，降低内存消耗

- 享元模式的目的：当系统中多处需要同一组信息时，可以把这些信息封装到一个对象中，然后对该对象进行缓存，这样，一个对象就可以提供给多处需要使用的地方，避免大量同一对象的多次创建，消耗大量内存空间。

享元模式其实就是 工厂模式 的一个改进机制，享元模式 同样要求创建一个或一组对象，并且就是通过工厂方法生成对象的，只不过 享元模式 中为工厂方法增加了缓存这一功能。

### 二、角色

- 抽象享元（Flyweight）角色：享元对象的抽象，定义了对象的外部状态和内部状态的接口或实现
- 享元（Concrete Flyweight）角色：具体的享元角色，抽象享元的实现类，实现了抽象角色定义的相关业务
- 享元工厂（Flyweight Factory）角色：享元工厂类，内部提供一个池容器，储存Concrete Flyweight，提供从池中存取数据的操作

### 三、总结

享元模式通常与工厂模式一起使用，可以极大减少内存中对象的数量，使得相同对象或相似对象在内存中只保存一份，降低内存占用，增强程序的性能。享元模式的外部状态相对独立，而且不会影响其内部状态，从而使得享元对象可以在不同的环境中被共享；但是这种模式需要分离出内部状态和外部状态，这使得程序的逻辑复杂化，而且为了使对象可以共享，需要将享元对象的外部状态必须具备固化特性，即不应该随内部状态改变而改变，否则会导致系统的逻辑混乱。

使用场景

- 系统中存在大量的相同或相似对象；
- 对象都具备较接近的外部状态，而且内部状态与环境无关，也就是说对象没有特定身份；
- 需要缓冲池的场景；
- 在Java中，数据库连接池，线程池等即是享元模式的应用。
