## 备忘录模式（Memento）

备忘录模式

### 一、说明

备忘录模式是一种对象行为模式。在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，还可以将该对象恢复到原先保存的状态。

模式本质：保存和恢复状态

设计意图：将该对象恢复到原先保存的状态

### 二、角色

- 源发起（Originator）角色：

  需要保存状态的类，可以访问备忘录里的所有信息，记录当前时刻的内部状态信息，提供创建备忘录和恢复备忘录数据的功能

- 备忘录（Memento）角色：

  保存源发起（Originator）对象状态，在需要的时候提供这些内部状态给源发起对象

- 守护者（Caretaker）角色：

  也叫负责人角色，提供保存与获取备忘录的功能，但不能对备忘录的内容进行访问与修改。

  若希望保存多个源发起（Originator）对象的不同时间的状态或者不同属性值，可以使用Hash Map实现

为了控制对备忘录对象的访问，备忘录模式中有两种设计方式：

1) 窄接口：

​		管理者只能看到备忘录的窄接口，窄接口的实现中通常没有任何的方法，只是一个类型标识。

​		窄接口使得守护对象只能将备忘录传递给其他对象。

2) 宽接口：

​		源发起对象能够看到备忘录的宽接口，从而可以从备忘录中获取到所需的数据，来将自己恢复到备忘录中所保存的状态。

​		理想情况是：只允许生成备忘录的源发起对象访问该备忘录的内部状态，通常实现成为原发器内的一个私有内部类。

### 三、总结

备忘录模式提供了一种可以恢复状态的机制。当用户需要时能够比较方便地将数据恢复到某个历史的状态。实现了内部状态的封装，除了创建它的发起人之外，其他对象都不能够访问这些状态信息。简化了源发起角色，源发起角色不需要管理和保存其内部状态的各个备份，所有状态信息都保存在备忘录中，并由守护者进行管理，这符合单一职责原则。但是如果需要保存的内部状态过多或操作备忘录过于频繁，会占用较大的资源。

使用场景：

1) 需要保存与恢复数据
2) 需要提供一个可回滚操作

常见应用场景：

1) 棋类游戏中的悔棋
2) 软件中的撤销操作
3) 数据库的事务管理中的回滚操作
4) 软件中的历史记录
